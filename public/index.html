<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LinkShield - Advanced URL Shortener</title>
    
    <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
    
    <style>
        /* To√†n b·ªô CSS c·ªßa b·∫°n gi·ªØ nguy√™n, kh√¥ng c·∫ßn thay ƒë·ªïi */
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&family=Inter:wght@400;500;600;700&display=swap');
        :root{--bg-primary:#0a0a0a;--bg-secondary:#111111;--bg-tertiary:#1a1a1a;--bg-card:#151515;--border:#333333;--border-hover:#444444;--text-primary:#ffffff;--text-secondary:#b3b3b3;--text-muted:#666666;--accent:#00d4aa;--accent-hover:#00b894;--warning:#fdcb6e;--error:#e74c3c;--success:#00b894;--purple:#a29bfe;--blue:#74b9ff;--orange:#fd79a8;--gradient-main:linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);--gradient-accent:linear-gradient(135deg, #00d4aa 0%, #00b894 100%);--shadow:0 8px 32px rgba(0, 0, 0, 0.3);--shadow-hover:0 12px 48px rgba(0, 0, 0, 0.4);}
        *{margin:0;padding:0;box-sizing:border-box;}
        body{font-family:'Inter', sans-serif;background:var(--bg-primary);color:var(--text-primary);min-height:100vh;overflow-x:hidden;}
        .bg-animation{position:fixed;top:0;left:0;width:100%;height:100%;z-index:-1;background:radial-gradient(ellipse at top, #1a1a2e 0%, #0a0a0a 50%);}
        .bg-animation::before{content:'';position:absolute;top:0;left:0;right:0;bottom:0;background-image:radial-gradient(circle at 25% 25%, #667eea 0%, transparent 50%),radial-gradient(circle at 75% 75%, #764ba2 0%, transparent 50%),radial-gradient(circle at 75% 25%, #f093fb 0%, transparent 50%);opacity:0.03;animation:float 20s ease-in-out infinite;}
        @keyframes float{0%, 100%{transform:translateY(0px) rotate(0deg);} 50%{transform:translateY(-20px) rotate(180deg);}}
        .container{max-width:1400px;margin:0 auto;padding:20px;position:relative;}
        .header{text-align:center;margin-bottom:50px;position:relative;}
        .header h1{font-family:'JetBrains Mono', monospace;font-size:3.5rem;font-weight:700;background:var(--gradient-main);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin-bottom:15px;position:relative;}
        .header h1::after{content:'';position:absolute;bottom:-10px;left:50%;transform:translateX(-50%);width:100px;height:3px;background:var(--gradient-accent);border-radius:2px;}
        .header p{font-size:1.2rem;color:var(--text-secondary);margin-top:20px;}
        .main-content{display:grid;grid-template-columns:1fr 1fr;gap:40px;margin-bottom:40px;}
        .card{background:var(--bg-card);border-radius:20px;padding:40px;box-shadow:var(--shadow);border:1px solid var(--border);position:relative;overflow:hidden;transition:all 0.3s ease;}
        .card::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:var(--gradient-main);}
        .card:hover{transform:translateY(-5px);box-shadow:var(--shadow-hover);border-color:var(--border-hover);}
        .card h2{font-family:'JetBrains Mono', monospace;font-size:1.5rem;margin-bottom:30px;color:var(--text-primary);display:flex;align-items:center;gap:12px;}
        .form-group{margin-bottom:25px;}
        .form-group label{display:block;margin-bottom:10px;font-weight:600;color:var(--text-secondary);font-size:0.95rem;}
        .form-group input, .form-group select{width:100%;padding:15px 20px;background:var(--bg-tertiary);border:2px solid var(--border);border-radius:12px;font-size:16px;color:var(--text-primary);transition:all 0.3s ease;font-family:'JetBrains Mono', monospace;}
        .form-group input:focus, .form-group select:focus{outline:none;border-color:var(--accent);box-shadow:0 0 0 3px rgba(0, 212, 170, 0.1);}
        .form-group input::placeholder{color:var(--text-muted);}
        .btn{width:100%;padding:18px;background:var(--gradient-accent);color:white;border:none;border-radius:12px;font-size:16px;font-weight:600;font-family:'JetBrains Mono', monospace;cursor:pointer;transition:all 0.3s ease;position:relative;overflow:hidden;}
        .btn:hover{transform:translateY(-2px);box-shadow:0 8px 25px rgba(0, 212, 170, 0.3);}
        .result{margin-top:25px;padding:20px;border-radius:12px;display:none;font-family:'JetBrains Mono', monospace;font-size:0.9rem;}
        .result.success{background:rgba(0, 184, 148, 0.1);border:1px solid var(--success);color:var(--success);}
        .result.error{background:rgba(231, 76, 60, 0.1);border:1px solid var(--error);color:var(--error);}
        .link-item{background:var(--bg-tertiary);border:1px solid var(--border);border-radius:15px;padding:25px;margin-bottom:20px;transition:all 0.3s ease;}
        .link-item:hover{border-color:var(--border-hover);transform:translateX(5px);}
        .link-item h4{font-family:'JetBrains Mono', monospace;margin-bottom:15px;color:var(--accent);display:flex;align-items:center;gap:10px;}
        .link-item p{margin-bottom:10px;color:var(--text-secondary);font-size:0.9rem;}
        .link-item strong{color:var(--text-primary);}
        .link-actions{display:flex;gap:12px;margin-top:20px;flex-wrap:wrap;}
        .btn-small{padding:8px 16px;background:var(--bg-secondary);color:var(--text-primary);border:1px solid var(--border);border-radius:8px;cursor:pointer;font-size:0.85rem;font-family:'JetBrains Mono', monospace;transition:all 0.3s ease;}
        .btn-small:hover{background:var(--accent);border-color:var(--accent);transform:translateY(-1px);}
        .btn-danger{background:var(--error);border-color:var(--error);}
        .btn-danger:hover{background:#c0392b;border-color:#c0392b;}
        .empty-state{text-align:center;padding:50px 20px;color:var(--text-muted);}
        .empty-state-icon{font-size:4rem;margin-bottom:20px;opacity:0.5;}
        .code-block{background:var(--bg-secondary);border:1px solid var(--border);border-radius:8px;padding:15px;font-family:'JetBrains Mono', monospace;font-size:0.9rem;color:var(--accent);word-break:break-all;margin:10px 0;}
        /* C√°c style kh√°c gi·ªØ nguy√™n */
    </style>
</head>
<body>
    <div class="bg-animation"></div>
    <div class="container">
        <div class="header">
            <h1>‚ö° LinkShield</h1>
            <p>Advanced URL Protection & Analytics Platform</p>
        </div>

        <div id="main-page">
            <div class="main-content">
                <div class="card">
                    <h2>üöÄ Create Protected Link</h2>
                    <form id="create-form">
                        <div class="form-group">
                            <label for="original-url">Original URL:</label>
                            <input type="url" id="original-url" placeholder="https://example.com" required>
                        </div>
                        <button type="submit" class="btn">Generate Protected Link</button>
                    </form>
                    <div id="create-result" class="result"></div>
                </div>

                <div class="card">
                    <h2>üìä My Links</h2>
                    <p style="color: var(--text-secondary); font-size: 0.9rem; margin-top: -20px; margin-bottom: 20px;">Links you create on this device will be saved here.</p>
                    <div id="my-links">
                        <div class="empty-state">
                            <div class="empty-state-icon">üîó</div>
                            <p>No links created from this device yet</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // D·ªØ li·ªáu link v·∫´n l∆∞u local ƒë·ªÉ hi·ªÉn th·ªã l·∫°i cho ng∆∞·ªùi d√πng tr√™n thi·∫øt b·ªã c·ªßa h·ªç
        let localLinks = JSON.parse(localStorage.getItem('linkshield_local_links') || '[]');

        function saveData() {
            localStorage.setItem('linkshield_local_links', JSON.stringify(localLinks));
        }

        function showResult(elementId, message, isError = false) {
            const result = document.getElementById(elementId);
            result.innerHTML = `<strong>${isError ? '‚ùå' : '‚úÖ'}</strong> ${message}`;
            result.className = 'result ' + (isError ? 'error' : 'success');
            result.style.display = 'block';
            setTimeout(() => { result.style.display = 'none'; }, 8000);
        }

        // --- THAY ƒê·ªîI QUAN TR·ªåNG: G·ªåI API BACKEND ---
        document.getElementById('create-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            const originalUrl = document.getElementById('original-url').value;
            const createButton = this.querySelector('.btn');
            createButton.disabled = true;
            createButton.textContent = 'Generating...';

            try {
                // G·ª≠i y√™u c·∫ßu POST t·ªõi API /api/create tr√™n server
                const response = await fetch('/api/create', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ originalUrl: originalUrl }),
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || 'Failed to create link');
                }

                const data = await response.json();
                const shortUrl = data.shortUrl;

                // Hi·ªÉn th·ªã k·∫øt qu·∫£ th√†nh c√¥ng
                const resultDiv = document.getElementById('create-result');
                resultDiv.innerHTML = `<strong>‚úÖ</strong> Protected link created successfully!
                    <div style="display: flex; align-items: center; gap: 10px; margin-top: 15px;">
                        <div class="code-block" style="flex-grow: 1; margin: 0;">${shortUrl}</div>
                        <button class="btn-small" onclick="copyToClipboard('${shortUrl}')">üìã Copy</button>
                    </div>`;
                resultDiv.className = 'result success';
                resultDiv.style.display = 'block';

                // L∆∞u link v√†o local storage ƒë·ªÉ qu·∫£n l√Ω
                const linkDataForStorage = {
                    id: 'local_' + Math.random().toString(36).substr(2, 9),
                    originalUrl: originalUrl,
                    shortUrl: shortUrl,
                    createdAt: new Date().toISOString(),
                };
                localLinks.push(linkDataForStorage);
                saveData();
                updateMyLinks(); // C·∫≠p nh·∫≠t danh s√°ch
                this.reset(); // Reset form

            } catch (error) {
                showResult('create-result', error.message, true);
            } finally {
                createButton.disabled = false;
                createButton.textContent = 'Generate Protected Link';
            }
        });
        
        // --- C·∫¨P NH·∫¨T H√ÄM HI·ªÇN TH·ªä DANH S√ÅCH LINK ---
        function updateMyLinks() {
            const myLinksContainer = document.getElementById('my-links');
            
            if (localLinks.length === 0) {
                myLinksContainer.innerHTML = `<div class="empty-state"><div class="empty-state-icon">üîó</div><p>No links created from this device yet</p></div>`;
                return;
            }
            
            // S·∫Øp x·∫øp link m·ªõi nh·∫•t l√™n ƒë·∫ßu
            localLinks.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));

            myLinksContainer.innerHTML = localLinks.map(link => {
                const displayOriginal = link.originalUrl.length > 50 ? link.originalUrl.substring(0, 50) + '...' : link.originalUrl;

                return `
                <div class="link-item">
                    <h4>üîó ${link.shortUrl}</h4>
                    <p><strong>Destination:</strong> ${displayOriginal}</p>
                    <p><strong>Created:</strong> ${new Date(link.createdAt).toLocaleString('vi-VN')}</p>
                    <div class="link-actions">
                        <button class="btn-small" onclick="copyToClipboard('${link.shortUrl}')">üìã Copy Link</button>
                        <button class="btn-small btn-danger" onclick="deleteLink('${link.id}')">üóëÔ∏è Forget</button>
                    </div>
                </div>
            `}).join('');
        }
        
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                // Hi·ªÉn th·ªã th√¥ng b√°o (c√≥ th·ªÉ t·∫°o m·ªôt h√†m ri√™ng ƒë·∫πp h∆°n)
                alert('Link copied to clipboard!');
            });
        }
        
        // X√≥a link kh·ªèi b·ªô nh·ªõ local (kh√¥ng x√≥a link th·∫≠t tr√™n server)
        function deleteLink(id) {
            if (confirm('Are you sure you want to remove this link from your local list? The short link will still work.')) {
                localLinks = localLinks.filter(link => link.id !== id);
                saveData();
                updateMyLinks();
            }
        }

        // Khi t·∫£i trang, hi·ªÉn th·ªã c√°c link ƒë√£ l∆∞u
        window.addEventListener('load', function() {
            updateMyLinks();
        });

    </script>
</body>
</html>